---
title: MCP Servers
---

# MCP Servers

Agent Runtimes provides comprehensive support for **MCP Servers**, enabling agents to access external tools and data sources through a standardized interface.

## Overview

MCP servers are external processes that provide tools, resources, and prompts to AI agents. Agent Runtimes manages these servers automatically:

- **Automatic Server Lifecycle** — MCP servers start with the application and stop on shutdown
- **Retry with Backoff** — Transient failures trigger automatic retries with exponential backoff
- **Sequential Startup** — Multiple MCP servers start sequentially to avoid resource conflicts
- **Status Monitoring** — Real-time status of all MCP toolsets via API endpoint

## MCP Server Examples

Agent Runtimes supports **any MCP-compatible server**—if it follows the [MCP specification](https://modelcontextprotocol.io/), it will work. The table below shows a few popular examples to get you started:

| Server | URL | Type | Description |
|--------|-------------|------|-------------|
| Tavily | [docs](https://docs.tavily.com/documentation/mcp) | Remote | Web search and content extraction |
| Filesystem | [modelcontextprotocol/servers](https://github.com/modelcontextprotocol/servers/tree/main/src/filesystem) | Local | File system access |
| GitHub | [github/github-mcp-server](https://github.com/github/github-mcp-server) | Local | GitHub repository access |
| Google Workspace | [taylorwilsdon/google_workspace_mcp](https://github.com/taylorwilsdon/google_workspace_mcp) | Local | Google Workspace (Gmail, Gdrive, etc.) access |
| Slack | [datalayer/slack-mcp-server](https://github.com/datalayer/slack-mcp-server) | Local | Slack workspace access |
| Kaggle | [docs](https://www.kaggle.com/mcp) | Remote | Kaggle datasets, models, competitions, notebooks |
| AlphaVantage | [docs](https://mcp.alphavantage.co/) | Local | Financial market data |
| Chart | [antvis/mcp-server-chart](https://github.com/antvis/mcp-server-chart) | Local | Charting and visualization |
| Brave Search | [modelcontextprotocol/servers](https://github.com/modelcontextprotocol/servers/tree/main/src/brave-search) | Local | Web search |
| LinkedIn | [stickerdaniel/linkedin-mcp-server](https://github.com/stickerdaniel/linkedin-mcp-server) | Local | LinkedIn profile, company, and job data |
:::info Local vs Remote MCP Servers
- **Local servers** run as child processes on your machine (started via `npx` or `uvx`)
- **Remote servers** are hosted externally and accessed over HTTP (e.g., Kaggle MCP)

Both types are configured in the same `mcp.json` file, but remote servers use `mcp-remote` as a bridge.
:::

See the [MCP Servers Directory](https://github.com/modelcontextprotocol/servers) for more options.

## Quick Start

### Basic Configuration

MCP servers are configured in `~/.datalayer/mcp.json`. Here's a minimal example:

```json
{
  "mcpServers": {
    "tavily-remote": {
      "command": "npx",
      "args": [
        "-y",
        "mcp-remote",
        "https://mcp.tavily.com/mcp/?tavilyApiKey=<your-api-key>"
      ]
    }
  }
}
```

Environment variables are automatically expanded using `${VAR_NAME}` syntax.

### Using MCP Tools in Agents

Once configured, agents automatically receive access to all running MCP toolsets:

```python
from pydantic_ai import Agent
from agent_runtimes.mcp import get_mcp_toolsets

# Get pre-loaded MCP toolsets
mcp_toolsets = get_mcp_toolsets()

# Create agent with MCP tools
agent = Agent(
    "anthropic:claude-sonnet-4-20250514",
    system_prompt="You are a helpful assistant.",
    toolsets=mcp_toolsets,
)
```

### Full Configuration Example

Here's a complete configuration with multiple servers:

```json
{
  "mcpServers": {
    "tavily-remote": {
      "command": "npx",
      "args": [
        "-y",
        "mcp-remote",
        "https://mcp.tavily.com/mcp/?tavilyApiKey=<your-api-key>"
      ]
    },
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/allowed/dir"]
    },
    "linkedin": {
      "command": "uvx",
      "args": [
        "--from",
        "git+https://github.com/stickerdaniel/linkedin-mcp-server",
        "linkedin-mcp-server"
      ]
    },
    "kaggle": {
      "command": "npx",
      "args": [
          "mcp-remote",
          "https://www.kaggle.com/mcp",
          "--header",
          "Authorization: Bearer <KAGGLE_TOKEN>"
      ]
  }
}
```

## Server-Specific Setup

### Tavily MCP Server

The [Tavily MCP Server](https://docs.tavily.com/documentation/mcp) provides web search and content extraction tools.

#### Configuration

```json
{
  "mcpServers": {
    "tavily-remote": {
      "command": "npx",
      "args": [
        "-y",
        "mcp-remote",
        "https://mcp.tavily.com/mcp/?tavilyApiKey=<your-api-key>"
      ]
    }
  }
}
```

Replace `<your-api-key>` with your Tavily API key from your Tavily account. You can get it from https://app.tavily.com/.

### Filesystem MCP Server

The [Filesystem MCP Server](https://github.com/modelcontextprotocol/servers/tree/main/src/filesystem) provides tools for interacting with the local filesystem.

#### Configuration

```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/allowed/dir"]
    }
  }
}
```

### GitHub MCP Server

The [GitHub MCP Server](https://github.com/github/github-mcp-server) provides tools for interacting with GitHub repositories.
#### Configuration

```json
{
  "mcpServers": {
    "github": {
      "command": "docker",
      "args": [
        "run",
        "-i",
        "--rm",
        "-e",
        "GITHUB_PERSONAL_ACCESS_TOKEN",
        "ghcr.io/github/github-mcp-server"
      ],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "<GITHUB_TOKEN>"
      }
    }
  }
}
``` 
Replace `<GITHUB_TOKEN>` with a GitHub personal access token with appropriate permissions. You can create it on https://github.com/settings/personal-access-tokens/new. Note that some tools might be disabled if your access token has limited permissions (e.g Read-only, etc.).

### Google Workspace MCP Server

The [Google Workspace MCP Server](https://github.com/taylorwilsdon/google_workspace_mcp) provides tools for interacting with Google Workspace services like Gmail and Google Drive.

#### Configuration

```json
{
  "mcpServers": {
    "google-workspace": {
      "command": "uvx",
      "args": ["workspace-mcp"],
      "env": {
        "GOOGLE_OAUTH_CLIENT_ID": "<your-client-id>",
        "GOOGLE_OAUTH_CLIENT_SECRET": "<your-client-secret>",
      }
}
```

Replace `<your-client-id>` and `<your-client-secret>` with your Google OAuth credentials To set up OAuth credentials:


**1. Create OAuth 2.0 Credentials**

Visit the [Google Cloud Console](https://console.cloud.google.com/):

1. Create a new project (or use an existing one)
2. Navigate to **APIs & Services** → **Credentials**
3. Click **Create Credentials** → **OAuth Client ID**
4. Choose **Desktop Application** as the application type (no redirect URIs needed!)
5. Download the credentials and note the **Client ID** and **Client Secret**

**2. Enable Required APIs**

In **APIs & Services** → **Library**, search for and enable the Google Workspace APIs you plan to use (Gmail, Drive, etc.).

**3. Configure Environment**

Set your OAuth credentials as environment variables:

```bash
export GOOGLE_OAUTH_CLIENT_ID="your-client-id"
export GOOGLE_OAUTH_CLIENT_SECRET="your-client-secret"
```
### Slack MCP Server

The [Slack MCP Server](https://github.com/zencoderai/slack-mcp-server) provides tools for interacting with Slack workspaces.

#### Configuration

```json
{
  "mcpServers": {
    "slack": {
      "command": "npx",
      "args": ["-y", "@datalayer/slack-mcp-server"],
      "env": {
        "SLACK_BOT_TOKEN": "<your-slack-bot-token>",
        "SLACK_TEAM_ID": "<your-slack-team-id>",
        "SLACK_CHANNEL_IDS": "<your-slack-channel-ids>"
      }
    }
  }
}
```
To get the credentials follow the instructions explained in: https://github.com/zencoderai/slack-mcp-server?tab=readme-ov-file#slack-bot-setup.

### Kaggle MCP Server

The [Kaggle MCP Server](https://www.kaggle.com/docs/mcp) is a **remote HTTP server** that provides access to Kaggle datasets, models, competitions, notebooks, and benchmarks.

#### Configuration Options

**Option 1: Token Authentication (recommended for Agent Runtimes)**

```json
{
  "mcpServers": {
    "kaggle": {
      "command": "npx",
      "args": [
        "-y",
        "mcp-remote",
        "https://www.kaggle.com/mcp",
        "--header",
        "Authorization: Bearer <KAGGLE_TOKEN>"
      ]
    }
  }
}
```

To get your token:
1. Go to **[kaggle.com/settings/account](https://www.kaggle.com/settings/account)**
2. Scroll to **API** section → Click **Create New Token**
3. Replace `<KAGGLE_TOKEN>` with the generated token value

For Agent Runtimes identity integration, see the [Kaggle section](../identity#kaggle) in the Identity documentation.

**Option 2: Browser OAuth (auto-login)**

```json
{
  "mcpServers": {
    "kaggle": {
      "command": "npx",
      "args": ["-y", "mcp-remote", "https://www.kaggle.com/mcp"]
    }
  }
}
```

This triggers a browser-based login on first tool call. Tokens are cached automatically.

#### Available Tools

| Category | Description |
|----------|-------------|
| **Notebooks** | Create, run, and manage Kaggle notebooks |
| **Datasets** | Search, download, and explore datasets |
| **Models** | Access and use Kaggle models |
| **Competitions** | Browse competitions, download data, submit predictions |
| **Benchmarks** | Access Kaggle benchmark tools |

### AlphaVantage MCP Server

The [AlphaVantage MCP Server](https://mcp.alphavantage.co/) provides financial market data tools.

#### Configuration

```json
{
  "mcpServers": {
    "alphavantage": {
      "command": "uvx",
      "args": ["av-mcp==0.2.1", "<YOUR_API_KEY>"],
      "env": {"MAX_RESPONSE_TOKENS": "100000"}
  }
}
```

Replace `<YOUR_API_KEY>` with your AlphaVantage API key from your AlphaVantage account. You can get it from https://www.alphavantage.co/support/#api-key.

### Chart MCP Server

The [Chart MCP Server](https://github.com/antvis/mcp-server-chart) provides charting and visualization tools.

#### Configuration

```json
{
  "mcpServers": {
    "chart": {
      "command": "npx",
      "args": ["-y", "@antv/mcp-server-chart"]
    }
  }
}
```

### LinkedIn MCP Server

The LinkedIn MCP server requires browser automation via Playwright.

#### Setup Steps

**Step 1: Install Playwright Chromium**

```bash
uvx --from playwright playwright install chromium
```

**Step 2: Create a Session File**

```bash
uvx --from git+https://github.com/stickerdaniel/linkedin-mcp-server linkedin-mcp-server --get-session
```

This opens a browser window for manual LinkedIn login (handles 2FA, captcha, etc.). You have 5 minutes to complete authentication. The session is saved to `~/.linkedin-mcp/session.json`.

**Step 3: Add to Configuration**

```json
{
  "mcpServers": {
    "linkedin": {
      "command": "uvx",
      "args": [
        "--from",
        "git+https://github.com/stickerdaniel/linkedin-mcp-server",
        "linkedin-mcp-server"
      ]
    }
  }
}
```

:::warning Session Expiration
Sessions may expire over time. If you encounter authentication errors, run `--get-session` again.
:::

:::tip Alternative: Cookie Authentication
You can also authenticate using your `li_at` cookie:
```json
"env": {
  "LINKEDIN_COOKIE": "${LINKEDIN_COOKIE}"
}
```
To get the cookie: DevTools (F12) → Application → Cookies → linkedin.com → copy `li_at` value.
However, session file authentication is more reliable.
:::

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                   FastAPI Application                        │
│                    (agent_runtimes)                         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓ Lifespan startup
┌─────────────────────────────────────────────────────────────┐
│               MCP Toolsets Manager                           │
│        (agent_runtimes/mcp/toolsets.py)                     │
└─────────────────────────────────────────────────────────────┘
          │                   │                   │
          ↓                   ↓                   ↓
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Tavily    │     │  LinkedIn   │     │   Kaggle    │
│ MCP Server  │     │ MCP Server  │     │ MCP Server  │
│  (local)    │     │  (local)    │     │  (remote)   │
└─────────────┘     └─────────────┘     └─────────────┘
```

### Server Startup Sequence

1. **Load Configuration** — Read `~/.datalayer/mcp.json` and expand environment variables
2. **Sequential Start** — Start each MCP server one at a time to avoid resource conflicts
3. **Retry Logic** — If a server fails with `BrokenResourceError`, retry up to 3 times with backoff
4. **Tool Discovery** — Once connected, list available tools from each server
5. **Status Tracking** — Track ready/failed servers for monitoring

## API Endpoints

### Status and Info

**Get MCP Toolsets Status**

```bash
GET /api/v1/configure/mcp-toolsets-status
```

```json
{
  "initialized": true,
  "ready_count": 2,
  "failed_count": 0,
  "ready_servers": ["tavily", "kaggle"],
  "failed_servers": {}
}
```

**Get MCP Toolsets Info**

```bash
GET /api/v1/configure/mcp-toolsets-info
```

```json
[
  {
    "type": "MCPServerStdio",
    "id": "tavily",
    "command": "npx",
    "args": ["-y", "tavily-mcp@0.1.3"]
  }
]
```

### Server Management

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/v1/mcp/servers` | GET | List all configured MCP servers |
| `/api/v1/mcp/servers/{id}` | GET | Get specific MCP server details |
| `/api/v1/mcp/servers` | POST | Add a new MCP server |
| `/api/v1/mcp/servers/{id}` | PUT | Update an MCP server |
| `/api/v1/mcp/servers/{id}` | DELETE | Remove an MCP server |

## UI Integration

The Agent Details panel in the chat UI displays real-time MCP toolsets status:

- ✓ Ready servers with green checkmarks
- ✗ Failed servers with error details
- Auto-refresh every 5 seconds

## Troubleshooting

### Debug Logging

Enable debug logging to see detailed MCP startup information:

```bash
python -m agent_runtimes --debug
```

### Common Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| **Timeout during startup** | First-time package downloads can take minutes | Wait for download to complete; default timeout is 5 minutes |
| **BrokenResourceError** | MCP server process crashed | Automatic retry (up to 3 times); check server logs |
| **Server not starting** | Missing command or env vars | Verify `npx`/`uvx` exists; check environment variables |
| **LinkedIn browser error** | Playwright not installed | Run `uvx --from playwright playwright install chromium` |
| **Kaggle permission error** | Not authenticated | Complete OAuth flow or set `KAGGLE_TOKEN` |
